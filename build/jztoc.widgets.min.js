/*
 * jztoc UI Components
 *
 * Copyright 2010, Acatl Pacheco
 * Licensed under the MIT License.
 *
 */
 
 
 $.ui.uicomponent.subclass("ui.list",{options:{dataProvider:[],itemRenderer:null,labelFunction:null,labelField:null,itemRendererOptions:null,styleFunction:null,rowFunction:null,loading:{label:"loading..",imageUrl:""},style:{width:80,height:100,padding:2,"background-color":"#fff","white-space":"nowrap","overflow-x":"hidden"}},_create:function(){this.element.css(this.options.style)},_init:function(){this.options.dataProvider!=null&&this.dataProvider(this.options.dataProvider)},dataProvider:function(a){this.options.dataProvider=
a;this.element.children().remove();for(var b in a){var f=a[b],d=$("<div></div>").appendTo(this.element),c=this._assignlabelData(f);if(this.options.itemRenderer!=null){var g={data:c,listData:{owner:this,data:f,index:b}};this.options.itemRendererOptions!=null&&jQuery.extend(g,this.options.itemRendererOptions);d[this.options.itemRenderer](g)}else d.html(c);typeof c=="string"&&this.options.showToolTip==true&&td.attr("title",c);this.options.styleFunction!=null&&this.options.styleFunction(d,b,f,this.options);
this.options.rowFunction!=null&&this.options.rowFunction(tr,b,f)}},_assignlabelData:function(a){if(this.options.labelFunction!=null)return this.options.labelFunction(a);if(this.options.labelField!=null)return a[this.options.labelField];if(typeof a=="object")return a.label;return a},showLoading:function(){this.element.children().hide();if(this.options.loading.label!="")$("<div></div>").attr("id","list-loading-text").appendTo(this.element).html(this.options.loading.label);else this.options.loading.imageUrl!=
""&&this.element.css({"background-image":"url("+this.options.loading.imageUrl+")","background-repeat":"no-repeat","background-position":"center center"})},hideLoading:function(){if(this.options.loading.label!="")$("#list-loading-text",this.element).remove();else this.options.loading.imageUrl!=""&&this.element.css({"background-image":"","background-repeat":"","background-position":""});this.element.children().show()},destroy:function(){this.element.children().remove()},_setOption:function(a,b){switch(a){case "dataProvider":this.dataProvider(b);
break}$.Widget.prototype._setOption.apply(this,arguments)}});
$.ui.uicomponent.subclass("ui.grid",{options:{dataProvider:null,columns:[],rowFunction:null},_create:function(){if(this.options.id==null||this.options.id=="")this.options.id=this._guid();this.table=$("<table></table>").attr("id",this.options.id).addClass("grid").appendTo(this.element);this.tableHead=$("<thead></thead>").appendTo(this.table);this.tableBody=$("<tbody></tbody>").appendTo(this.table);this._createTableHeader(this.options.columns);this.options.dataProvider!=null&&this._updateData()},_createTableHeader:function(a){tr=
$("<tr></tr>");var b=0;for(var f in a){var d=a[f],c=$("<th></th>");c.addClass("col"+b+"");c.addClass("header");c.attr("data-field",d.field);d.headerAttr!=null&&c.attr(d.headerAttr);d.width!=null&&c.css("width",d.width);if(d.sortable!=false){c.bind("click",{sortField:d.field},$.proxy(this._sort,this));var g=$("<table></table>").appendTo(c),e=$("<tr></tr>").appendTo(g);$("<th></th>").appendTo(e).html(d.label);$("<th></th>").appendTo(e).html(" ").addClass("sort-arrow");g.addClass("sortable");this._applyStyle(g,
d.headerStyle)}else{this._applyStyle(c,d.headerStyle);c.html(d.label)}d.visible==false&&c.hide();c.appendTo(tr);b++}tr.appendTo(this.tableHead)},_updateData:function(){$(this.tableBody).children().remove();var a=this.options.dataProvider;for(var b in a){var f=a[b],d=$("<tr></tr>").appendTo(this.tableBody),c=this._guid();d.attr("data-uid",c);this.options.rowFunction!=null&&this.options.rowFunction(d,b,f);for(var g in this.options.columns){c=this.options.columns[g];var e=$("<td></td>").appendTo(d);
e.addClass("col"+g+"");e.addClass("column");e.attr("data-field",c.field);c.width!=null&&e.css("width",c.width);this._applyStyle(e,c.style);var h=this._assignlabelData(f,c);c.visible==false&&e.hide();if(c.itemRenderer!=null){var i={data:h,listData:{owner:this,data:f,column:c,index:b,td:e,tr:d}};c.itemRendererOptions!=null&&jQuery.extend(i,c.itemRendererOptions);$(e)[c.itemRenderer](i)}else e.html(h);typeof h=="string"&&c.showToolTip==true&&e.attr("title",h);c.styleFunction!=null&&c.styleFunction(e,
b,f,c)}}},_assignlabelData:function(a,b){if(b.labelFunction!=null)return b.labelFunction(a,b);if(b.labelField!=null)return a[b.field][b.labelField];if(a[b.field]!=null)return a[b.field];return""},_setOption:function(a,b){switch(a){case "dataProvider":this.options.dataProvider=b;this._updateData();break;case "columns":this.options.columns=b;this._updateData();break}$.Widget.prototype._setOption.apply(this,arguments)},_sort:function(a){var b=$(a.currentTarget),f=$(".sortArrow",b).hasClass("up");$(".sortArrow",
this.tableHead).removeClass("up down");$(".sortArrow",b).addClass(f?"down":"up");b=jQuery.Event("onColumnSort");b.sortField=a.data.sortField;$(this.element).trigger(b);return false},showLoading:function(){this.table.addClass("loading");this.tableBody.animate({opacity:0.1},200)},hideLoading:function(){this.table.removeClass("loading");this.tableBody.animate({opacity:1},200)},_applyStyle:function(a,b){a==null||b==null||(typeof b=="string"?a.addClass(b):a.css(b))},_guid:function(){var a=function(){return((1+
Math.random())*65536|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},destroy:function(){$.Widget.prototype.destroy.apply(this,arguments)}});
