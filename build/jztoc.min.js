/*
 * jztoc UI Components
 *
 * Copyright 2010, Acatl Pacheco
 * Licensed under the MIT License.
 *
 */
 
 
 $.widget("ui.list",{options:{dataProvider:[],itemRenderer:null,labelFunction:null,labelField:null,itemRendererOptions:null,styleFunction:null,rowFunction:null,loading:{label:"loading..",imageUrl:""},style:{width:80,height:100,padding:2,"background-color":"#fff","white-space":"nowrap","overflow-x":"hidden"}},_create:function(){this.element.css(this.options.style);this.options.dataProvider!=null&&this.dataProvider(this.options.dataProvider)},dataProvider:function(a){this.options.dataProvider=a;this.element.children().remove();
for(var b in a){var e=a[b],g=$("<div></div>").appendTo(this.element),d=this._assignlabelData(e);if(this.options.itemRenderer!=null){var c={data:d,listData:{owner:this,data:e,index:b}};this.options.itemRendererOptions!=null&&jQuery.extend(c,this.options.itemRendererOptions);g[this.options.itemRenderer](c)}else g.html(d);typeof d=="string"&&this.options.showToolTip==true&&td.attr("title",d);this.options.styleFunction!=null&&this.options.styleFunction(g,b,e,this.options);this.options.rowFunction!=null&&
this.options.rowFunction(tr,b,e)}},_assignlabelData:function(a){if(this.options.labelFunction!=null)return this.options.labelFunction(a);if(this.options.labelField!=null)return a[this.options.labelField];if(typeof a=="object")return a.label;return a},showLoading:function(){this.element.children().hide();if(this.options.loading.label!="")$("<div></div>").attr("id","list-loading-text").appendTo(this.element).html(this.options.loading.label);else this.options.loading.imageUrl!=""&&this.element.css({"background-image":"url("+
this.options.loading.imageUrl+")","background-repeat":"no-repeat","background-position":"center center"})},hideLoading:function(){if(this.options.loading.label!="")$("#list-loading-text",this.element).remove();else this.options.loading.imageUrl!=""&&this.element.css({"background-image":"","background-repeat":"","background-position":""});this.element.children().show()},destroy:function(){this.element.children().remove()},_setOption:function(a,b){switch(a){case "dataProvider":this.dataProvider(b);
break}$.Widget.prototype._setOption.apply(this,arguments)}});
$.widget("ui.grid",{options:{dataProvider:null,columns:[],rowFunction:null},_create:function(){this.loadingImg=$("<div></div>").addClass("loading").appendTo(this.element);this.table=$("<table></table>").addClass("wiregrid").appendTo(this.element);this.tableHead=$("<thead></thead>").addClass("ad-header").appendTo(this.table);this.tableBody=$("<tbody></tbody>").appendTo(this.table);this._createTableHeader(this.options.columns);this.options.dataProvider!=null&&this._updateData();this.loadingImg.css("width",
this.element.css("width"))},_createTableHeader:function(a){var b=this;tr=$("<tr></tr>").css("height","25px");var e=0;$.each(a,function(g,d){var c=$("<th></th>").attr("axis","col"+e+"");if(d.style!=null)typeof d.style=="string"?$(c).addClass(d.style):$(c).css(d.style);if(d.sortable!=false)var f=$('<a href="#"></a>').html(d.label).addClass("wiregrid-sortable-th").bind("click",{sortField:d.field},$.proxy(b._sort,f)).appendTo(c);else c.html(d.label);d.visible==false&&c.hide();c.appendTo(tr);e++});tr.appendTo(this.tableHead)},
_updateData:function(){$(this.tableBody).children().remove();var a=this.options.dataProvider;for(var b in a){var e=a[b],g=$("<tr></tr>").appendTo(this.tableBody);this.options.rowFunction!=null&&this.options.rowFunction(g,b,e);for(var d in this.options.columns){var c=this.options.columns[d],f=$("<td></td>").appendTo(g);if(c.style!=null)typeof c.style=="string"?$(f).addClass(c.style):$(f).css(c.style);var h=this._assignlabelData(e,c);if(c.itemRenderer!=null){var i={owner:this,data:e,column:c};$(f)[c.itemRenderer]({data:h,
listData:i})}else f.html(h);typeof h=="string"&&c.showToolTip==true&&f.attr("title",h);c.styleFunction!=null&&c.styleFunction(f,b,e,c)}}},_assignlabelData:function(a,b){if(b.labelFunction!=null)return b.labelFunction(a,b);if(b.labelField!=null)return a[b.field][b.labelField];if(a[b.field]!=null)return a[b.field];return""},_setOption:function(a,b){switch(a){case "dataProvider":this.options.data=b;this._updateData();break}$.Widget.prototype._setOption.apply(this,arguments)},_sort:function(a){var b=
jQuery.Event("onColumnSort");b.sortField=a.data.sortField;$(this).trigger(b);return false},on_loading:function(){this.tableBody.animate({opacity:0.1},200);var a=this.table.css("height");this.loadingImg.css("width",this.element.css("width"));a<this.loadingImg.css("height")?this.loadingImg.css("height",70):this.loadingImg.css("height",a);this.loadingImg.fadeIn("fast")},on_load:function(){this.tableBody.animate({opacity:1},200);this.loadingImg.fadeOut("fast")},destroy:function(){$.Widget.prototype.destroy.apply(this,
arguments)}});$.widget("ui.columnitemrenderer",{options:{data:{}},_create:function(){$("<div style='white-space: nowrap; width:inherit; overflow:hidden; text-overflow: ellipsis; -o-text-overflow: ellipsis; white-space: nowrap;'></div>").html(this.options.data).appendTo(this.element)},destroy:function(){$.Widget.prototype.destroy.apply(this,arguments)}});
