/*!
 * jStoc UI Components
 *
 * Copyright 2010, Acatl Pacheco
 * Licensed under the MIT License.
 *
 */
 
 
 $.widget("ui.list",{options:{dataProvider:[],itemRenderer:null,labelFunction:null,labelField:null,itemRendererOptions:null,styleFunction:null,rowFunction:null,loading:{label:"loading..",imageUrl:""},style:{width:80,height:100,padding:2,"background-color":"#fff","white-space":"nowrap","overflow-x":"hidden"}},_create:function(){this.element.css(this.options.style);if(this.options.dataProvider!=null){this.dataProvider(this.options.dataProvider)}},dataProvider:function(g){var f=g;this.options.dataProvider=g;this.element.children().remove();for(var b in f){var e=f[b];var c=$("<div></div>").appendTo(this.element);var a=this._assignlabelData(e);if(this.options.itemRenderer!=null){var d={owner:this,data:e,index:b};var h={data:a,listData:d};if(this.options.itemRendererOptions!=null){jQuery.extend(h,this.options.itemRendererOptions)}c[this.options.itemRenderer](h)}else{c.html(a)}if(typeof a=="string"&&this.options.showToolTip==true){td.attr("title",a)}if(this.options.styleFunction!=null){this.options.styleFunction(c,b,e,this.options)}if(this.options.rowFunction!=null){this.options.rowFunction(tr,b,e)}}},_assignlabelData:function(a){if(this.options.labelFunction!=null){return this.options.labelFunction(a)}if(this.options.labelField!=null){return a[this.options.labelField]}if(typeof a=="object"){return a.label}return a},showLoading:function(){this.element.children().hide();if(this.options.loading.label!=""){$("<div></div>").attr("id","list-loading-text").appendTo(this.element).html(this.options.loading.label)}else{if(this.options.loading.imageUrl!=""){this.element.css({"background-image":"url("+this.options.loading.imageUrl+")","background-repeat":"no-repeat","background-position":"center center"})}}},hideLoading:function(){if(this.options.loading.label!=""){$("#list-loading-text",this.element).remove()}else{if(this.options.loading.imageUrl!=""){this.element.css({"background-image":"","background-repeat":"","background-position":""})}}this.element.children().show()},destroy:function(){this.element.children().remove()},_setOption:function(a,b){switch(a){case"dataProvider":this.dataProvider(b);break}$.Widget.prototype._setOption.apply(this,arguments)}});$.widget("ui.grid",{options:{dataProvider:null,columns:[],rowFunction:null},_create:function(){this.loadingImg=$("<div></div>").addClass("loading").appendTo(this.element);this.table=$("<table></table>").addClass("wiregrid").appendTo(this.element);this.tableHead=$("<thead></thead>").addClass("ad-header").appendTo(this.table);this.tableBody=$("<tbody></tbody>").appendTo(this.table);this._createTableHeader(this.options.columns);if(this.options.dataProvider!=null){this._updateData()}this.loadingImg.css("width",this.element.css("width"))},_createTableHeader:function(d){var e=this;tr=$("<tr></tr>").css("height","25px");var f=0;$.each(d,function(b,c){var a=$("<th></th>").attr("axis","col"+f+"");if(c.style!=null){if(typeof c.style=="string"){$(a).addClass(c.style)}else{$(a).css(c.style)}}if(c.sortable!=false){var h=$('<a href="#"></a>').html(c.label).addClass("wiregrid-sortable-th").bind("click",{sortField:c.field},$.proxy(e._sort,h)).appendTo(a)}else{a.html(c.label)}if(c.visible==false){a.hide()}a.appendTo(tr);f++});tr.appendTo(this.tableHead)},_updateData:function(){$(this.tableBody).children().remove();var c=this.options.dataProvider;for(var o in c){var q=c[o];var m=$("<tr></tr>").appendTo(this.tableBody);if(this.options.rowFunction!=null){this.options.rowFunction(m,o,q)}for(var n in this.options.columns){var l=this.options.columns[n];var r=$("<td></td>").appendTo(m);if(l.style!=null){if(typeof l.style=="string"){$(r).addClass(l.style)}else{$(r).css(l.style)}}var k=this._assignlabelData(q,l);if(l.itemRenderer!=null){var p={owner:this,data:q,column:l};$(r)[l.itemRenderer]({data:k,listData:p})}else{r.html(k)}if(typeof k=="string"&&l.showToolTip==true){r.attr("title",k)}if(l.styleFunction!=null){l.styleFunction(r,o,q,l)}}}},_assignlabelData:function(c,d){if(d.labelFunction!=null){return d.labelFunction(c,d)}if(d.labelField!=null){return c[d.field][d.labelField]}if(c[d.field]!=null){return c[d.field]}return""},_setOption:function(d,c){switch(d){case"dataProvider":this.options.data=c;this._updateData();break}$.Widget.prototype._setOption.apply(this,arguments)},_sort:function(c){var d=jQuery.Event("onColumnSort");d.sortField=c.data.sortField;$(this).trigger(d);return false},on_loading:function(){this.tableBody.animate({opacity:0.1},200);var b=this.table.css("height");this.loadingImg.css("width",this.element.css("width"));if(b<this.loadingImg.css("height")){this.loadingImg.css("height",70)}else{this.loadingImg.css("height",b)}this.loadingImg.fadeIn("fast")},on_load:function(){this.tableBody.animate({opacity:1},200);this.loadingImg.fadeOut("fast")},destroy:function(){$.Widget.prototype.destroy.apply(this,arguments)}});$.widget("ui.columnitemrenderer",{options:{data:{}},_create:function(){var b=$("<div style='white-space: nowrap; width:inherit; overflow:hidden; text-overflow: ellipsis; -o-text-overflow: ellipsis; white-space: nowrap;'></div>").html(this.options.data).appendTo(this.element)},destroy:function(){$.Widget.prototype.destroy.apply(this,arguments)}});